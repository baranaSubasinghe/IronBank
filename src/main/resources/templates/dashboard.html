<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Iron Bank | Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

    /* Navbar Styling */
    .navbar { background: linear-gradient(to right, #2c3e50, #4ca1af); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .navbar-brand { font-weight: bold; color: white !important; font-size: 1.5rem; }
    .nav-link { color: rgba(255,255,255,0.9) !important; }

    /* Card Styling */
    .card { border: none; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); transition: transform 0.2s; }
    .card:hover { transform: translateY(-5px); }
    .card-header { background-color: white; border-bottom: 1px solid #f0f0f0; font-weight: bold; padding: 15px 20px; border-radius: 15px 15px 0 0 !important; }

    /* Balance Card Special Style */
    .balance-card { background: linear-gradient(135deg, #00b09b, #96c93d); color: white; }

    /* Table Styling */
    .table-hover tbody tr:hover { background-color: #f1f2f6; }
    .money-plus { color: #27ae60; font-weight: bold; }
    .money-minus { color: #e74c3c; font-weight: bold; }

    /* Utilities */
    .icon-box { width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 10px; margin-right: 10px; }
    .bg-light-blue { background-color: #e8f4f8; color: #3498db; }
    .bg-light-orange { background-color: #fef5e6; color: #f39c12; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark mb-4">
  <div class="container">
    <a class="navbar-brand" href="#"><i class="fas fa-university me-2"></i> IRON BANK</a>
    <div class="d-flex align-items-center">
            <span class="text-white me-3 d-none d-md-block">
                Signed in as: <strong th:text="${username}">User</strong>
            </span>
      <form th:action="@{/logout}" method="post" class="m-0">
        <button type="submit" class="btn btn-outline-light btn-sm rounded-pill px-3">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </form>
    </div>
  </div>
</nav>

<div class="container">

  <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
    <i class="fas fa-exclamation-circle me-2"></i> <strong th:text="${param.error}">Error</strong>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  <div th:if="${param.success}" class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
    <i class="fas fa-check-circle me-2"></i> <strong th:text="${param.success}">Success</strong>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div class="row g-4">

    <div class="col-lg-4">

      <div class="card balance-card mb-4 p-4 text-center">
        <p class="mb-1 opacity-75">Available Balance</p>
        <h1 class="display-5 fw-bold mb-0" th:text="${'Rs. ' + balance}">Rs. 0.00</h1>
        <div class="mt-3 badge bg-white text-dark opacity-75 fs-6">
          <i class="fas fa-wallet me-1"></i> <span th:text="${accountNumber}">ACC-123</span>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">
          <div class="icon-box bg-light-orange"><i class="fas fa-user-plus"></i></div>
          Add New Contact
        </div>
        <div class="card-body">
          <form th:action="@{/add-contact}" method="post">
            <div class="mb-2">
              <input type="text" name="name" class="form-control" placeholder="Nickname (e.g. Batman)" required>
            </div>
            <div class="mb-3">
              <input type="text" name="accountNumber" class="form-control" placeholder="Account Number" required>
            </div>
            <button type="submit" class="btn btn-warning w-100 text-white fw-bold">Save Contact</button>
          </form>
        </div>
      </div>

    </div>

    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <div class="icon-box bg-light-blue"><i class="fas fa-paper-plane"></i></div>
          Quick Transfer
        </div>
        <div class="card-body p-4">
          <form th:action="@{/sendMoney}" method="post">
            <div class="row">
              <div class="col-md-7 mb-3">
                <label class="form-label fw-bold text-secondary">Recipient</label>

                <select id="contactSelect" class="form-select mb-2" onchange="fillAccount(this.value)">
                  <option value="">-- Select Saved Contact --</option>
                  <option th:each="contact : ${contacts}"
                          th:value="${contact.accountNumber}"
                          th:text="${contact.name + ' (' + contact.accountNumber + ')'}">
                  </option>
                </select>

                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="fas fa-hashtag"></i></span>
                  <input type="text" id="receiverAccountNumber" name="receiverAccountNumber" class="form-control" placeholder="Or type Account Number..." required>
                </div>
              </div>

              <div class="col-md-5 mb-3">
                <label class="form-label fw-bold text-secondary">Amount</label>
                <div class="input-group">
                  <span class="input-group-text fw-bold">Rs.</span>
                  <input type="number" name="amount" class="form-control" step="0.01" min="1" placeholder="0.00" required>
                </div>
              </div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg w-100 mt-2 shadow-sm">
              Proceed to Transfer <i class="fas fa-arrow-right ms-2"></i>
            </button>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
                    <span>
                        <div class="icon-box bg-light"><i class="fas fa-history"></i></div>
                        Recent Transactions
                    </span>
          <span class="badge bg-secondary rounded-pill" th:text="${transactions.size() + ' records'}">0</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
              <tr>
                <th class="ps-4">Date</th>
                <th>Details</th>
                <th class="text-end">Amount</th>
                <th class="text-center pe-4">Receipt</th> </tr>
              </thead>
              <tbody>
              <tr th:if="${#lists.isEmpty(transactions)}">
                <td colspan="4" class="text-center py-4 text-muted">
                  <i class="fas fa-receipt fa-2x mb-2 d-block"></i> No transactions found.
                </td>
              </tr>
              <tr th:each="trans : ${transactions}">
                <td class="ps-4 text-secondary" style="font-size: 0.9rem;">
                  <i class="far fa-calendar-alt me-1"></i>
                  <span th:text="${#temporals.format(trans.timestamp, 'MMM dd, HH:mm')}">Jan 01</span>
                </td>
                <td>
                  <div th:if="${trans.senderName == username}">
                    <span class="badge bg-danger bg-opacity-10 text-danger me-1">Sent</span>
                    To: <strong th:text="${trans.receiverName}">Bob</strong>
                  </div>
                  <div th:if="${trans.receiverName == username}">
                    <span class="badge bg-success bg-opacity-10 text-success me-1">Received</span>
                    From: <strong th:text="${trans.senderName}">Alice</strong>
                  </div>
                </td>
                <td class="text-end fw-bold">
                                        <span th:if="${trans.senderName == username}" class="text-danger">
                                            - Rs. <span th:text="${trans.amount}">100</span>
                                        </span>
                  <span th:if="${trans.receiverName == username}" class="text-success">
                                            + Rs. <span th:text="${trans.amount}">100</span>
                                        </span>
                </td>

                <td class="text-center pe-4">
                  <a th:href="@{/download-receipt/{id}(id=${trans.id})}" class="btn btn-sm btn-outline-secondary" title="Download PDF">
                    <i class="fas fa-file-download"></i>
                  </a>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function fillAccount(accountNumber) {
    if (accountNumber) {
      document.getElementById('receiverAccountNumber').value = accountNumber;
    }
  }
</script>

</body>
</html>